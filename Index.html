<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="style/style.css">
		<script src="js/pixi.min.js"></script>
		<script type="text/javascript">
			let app;
			let graphics;
			var isDrawing = false;
			var x = 0;
			var y = 0;
			var count = 0;
			window.onload = function(){
				
				var canvasContainer = document.getElementById("areaCanvasContainer");
				//Create a Pixi Application
				app = new PIXI.Application({ 
					width: 600,
					height: 500,
					antialias: false,
					transparent: false,
					resolution: 1,
					forceCanvas: false,
					backgroundColor: 0xFFFFFF
				});
				canvasContainer.appendChild(app.view);
				
				//app.view.addEventListener("touchstart", function(e) {    e.preventDefault();},{passive: false});
				//app.view.addEventListener("touchmove", function(e) {    e.preventDefault();},{passive: false});
				
				graphics = new PIXI.Graphics();
				graphics.interactive = true;
				graphics.buttonMode = true;
				
				graphics.beginFill(0xFFFFFF);
				graphics.drawRect(0, 0, 600, 500);
				graphics.endFill();
				
				graphics.on("pointerdown", mousedown);
				graphics.on("pointermove", mousemove);
				graphics.on("pointerup", mouseup);
				graphics.on("pointerupoutside", mouseup);
				
				app.stage.addChild(graphics);
			}
			
			function mousedown(e) {
				console.log("Down");
				x = e.data.global.x;
				y = e.data.global.y;
				isDrawing = true;
			}
			
			function mousemove(e) {
				if (isDrawing === true) {
					if(Math.abs(x - e.data.global.x) > 2 || Math.abs(y - e.data.global.y ) > 2 ){
						drawLine(graphics, x, y, e.data.global.x, e.data.global.y);
						x = e.data.global.x;
						y = e.data.global.y;
					}
				}
			}
			
			function mouseup(e) {
				if (isDrawing === true) {
					drawLine(graphics, x, y, e.data.global.x, e.data.global.y);
					x = 0;
					y = 0;
					isDrawing = false;
				}
			}
			
			function drawLine(graphics, x1, y1, x2, y2) {
				if(!(x1 === x2 && y1 === y2)){
					graphics.lineStyle(3, 0x000000,1,0.5,false);
					//graphics.line.cap = PIXI.LINE_CAP.ROUND;
					graphics.moveTo(x1, y1);
					graphics.lineTo(x2, y2);
					
					//test
					// close path with smaller gaps?
					graphics.closePath();
				}
			}
		</script>
	</head>
	
	<body>
		<div id="areaMain">
			<h1>DrawV</h1>
			<div id="areaCanvasContainer">
				<!--<canvas id="canvasDraw" width="600" height="500" />-->
			</div>
			<div id="areaControls">
				<button>Test</button>
			</div>
		</div>
	</body>
</html>